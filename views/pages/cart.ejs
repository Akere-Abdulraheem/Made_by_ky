<%
const pagetitle = 'Cart';
const pageDescription = 'Your Cart';
%>

<%- include ('../layout/header', { pagetitle }) %>
<%- include ('../layout/nav') %>

<div class="container">
    <%- include('../layout/subheaders', {pageDescription }) %>
</div>

<section class="cart .container mt-2 my-3 py-5 text-center">
   <table class="pt-5 table table-striped text-center" style="width: 100%;">

    <% if (cart && cart.length > 0) { %>

        <% cart.forEach(function(product) { %>        
            <tr>
                <!-- product image -->
                <td>
                    <div>
                        <img src="<%= product.image %>" alt="<%= product.name %>" class="rounded img-fluid">
                    </div>
                </td>

                <!-- product name -->
                <td>
                    <p> <%= product.name %></p>
                </td>

                <!-- product price -->
                <td>
                    <% if(product.sale_price){ %>
                        <small><span>NGN </span><%= product.sale_price %></small>
                    <% } else{ %>
                        <small><span>NGN </span><%= product.price %></small>
                    <% } %> 
                </td>

                <!-- edit buttons -->
                <td>
                    <form method="post" action="/edit_product_quantity">
                        <div class="row">
                            <div class="col">
                                <input type="hidden" value="<%= product.id %>" name="id">
                                <input type="submit" value="-" name="decreaseProductQuantity">
                                <input type="text" name="quantity" value="<%= product.quantity %>" readonly class="text-center" style="height:35px; width:30px" >
                                <input type="submit" value="+" name="increaseProductQuantity">
                            </div>
                        </div>
                    </form>
                </td>

                <!-- price -->
                <td>
                    <% if(product.sale_price){ %>
                        <span class="product-price">NGN <%= product.sale_price * product.quantity %></span>
                    <% } else { %>
                        <span class="product-price">NGN <%= product.price * product.quantity %></span>
                    <% } %>
                </td>

                <!-- remove button -->
                <td>
                    <form method="post" action="/remove_product">
                        <input type="hidden" name="id" value="<%= product.id %>">
                        <input type="submit" name="remove_btn" class="remove-btn" value="remove">
                    </form>
                </td>
            </tr>
        <% }) %>

        <% if(status === "loggedIn"){ %>

            <div class="cart-total">
                <table class='d-flex justify-content-center align-items-center' style="width: 100%;">
                    <thead>
                        <tr>
                            <th colspan="2">Shipping Mode</th>
                        </tr>
                    </thead>
                    <tbody>
                        <form id="shipping-form" method="post" action="/update-shipping">
                            <tr>
                                <td>
                                    <input type="radio" id="lagos-park" name="shipping_location" value="lagos_park" <% if (shippingLocation === 'lagos_park') { %> checked <% } %> onchange="submitForm()">
                                    <label for="lagos-park">Lagos park delivery: NGN2500</label>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <input type="radio" id="lagos-doorstep" name="shipping_location" value="lagos_doorstep" <% if (shippingLocation === 'lagos_doorstep') { %> checked <% } %> onchange="submitForm()">
                                    <label for="lagos-doorstep">Lagos doorstep delivery: NGN5000</label>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <input type="radio" id="ibadan" name="shipping_location" value="ibadan" <% if (shippingLocation === 'ibadan') { %> checked <% } %> onchange="submitForm()">
                                    <label for="ibadan">Ibadan delivery: NGN1500</label>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <input type="radio" id="other-states" name="shipping_location" value="other_states" <% if (shippingLocation === 'other_states') { %> checked <% } %> onchange="submitForm()">
                                    <label for="other-states">Other states delivery: NGN3000</label>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <input type="radio" id="international" name="shipping_location" value="international" <% if (shippingLocation === 'international') { %> checked <% } %> onchange="submitForm()">
                                    <label for="international">International (Packages below 1.5kg): $50</label>
                                </td>
                            </tr>
                        </form>
                    </tbody>
                </table>

                <div class="form-group">
                    <label for="subtotal">Subtotal:</label>
                    <input type="text" id="subtotal" readonly value="NGN <%= subTotal %>">
                </div>

                <div class="form-group">
                    <label for="total">Total:</label>
                    <input type="text" id="total" readonly value="NGN <%= total %>">
                </div>

                <div class="d-flex justify-content-center align-items-center checkout-container">
                    <form method="get" action="/checkout">
                        <input type="submit" class="btn checkout-btn" value="Checkout"> 
                    </form>
                </div>

            </div>

        <% } else { %>
            <div>
                <p>Please <a href="/login">Login</a> to checkout</p>
            </div>
        <% } %>

    <% } else { %>
        <p>You have no items in your shopping cart.</p>
        <a href="/new_arrival">Go to shop</a>
    <% } %>
    </table>
</div>

<script>
    function submitForm() {
        document.getElementById('shipping-form').submit();
    }
</script>

<%- include ('../layout/footer') %>
<%- include ('../layout/scripts') %>